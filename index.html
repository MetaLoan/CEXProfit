<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>晒单图生成器 - 静态版</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="fonts/harmonyos-sans.css">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="app">
    <!-- 左侧控制面板 -->
    <div class="control-panel">
      <div class="panel-header">
        <h1>📊 晒单图生成器</h1>
        <span class="badge">静态版 v2.2</span>
      </div>

      <!-- 配置导入 -->
      <div class="form-group">
        <label>📂 配置模板</label>
        <div style="display:flex;gap:8px;">
          <select id="configSelect" style="flex:1;" onchange="onConfigSelectChange()">
            <!-- 选项由 JS 动态生成 -->
          </select>
          <button class="btn-small" onclick="document.getElementById('configFile').click()">导入</button>
        </div>
        <input type="file" id="configFile" accept=".json" style="display:none" onchange="importConfig(event)">
        <div class="hint" id="configName">加载中...</div>
      </div>

      <!-- 交易对输入 -->
      <div class="form-group">
        <label>📈 交易对</label>
        <div style="display:flex;gap:8px;">
          <input type="text" id="tradepair" value="ETHUSDT" placeholder="输入交易对，如 BTCUSDT" style="flex:1;" list="tradepairList">
          <datalist id="tradepairList">
            <option value="BTCUSDT">
            <option value="ETHUSDT">
            <option value="SOLUSDT">
            <option value="BNBUSDT">
            <option value="XRPUSDT">
            <option value="DOGEUSDT">
          </datalist>
        </div>
      </div>

      <!-- 底图 -->
      <div class="form-group">
        <label>🖼️ 底图</label>
        <div style="display:flex;gap:8px;align-items:center;">
          <span id="bgStatus" style="flex:1;font-size:12px;color:var(--text-secondary);">使用默认底图</span>
          <button class="btn-small" onclick="document.getElementById('bgFile').click()">更换底图</button>
          <button class="btn-small" onclick="resetBackground()" title="重置">↺</button>
        </div>
        <input type="file" id="bgFile" accept="image/*" style="display:none" onchange="loadCustomBg(event)">
      </div>

      <!-- 方向 -->
      <div class="form-row">
        <div class="form-group">
          <label>方向</label>
          <select id="direction" onchange="calculateYield()">
            <option value="long">做多</option>
            <option value="short">做空</option>
          </select>
        </div>
        <div class="form-group">
          <label>动作</label>
          <select id="action">
            <option value="close">平仓</option>
          </select>
        </div>
      </div>

      <!-- 杠杆 -->
      <div class="form-group">
        <label>杠杆倍数</label>
        <input type="number" id="leverage" value="50" min="1" max="500">
      </div>

      <!-- 收益率 -->
      <div class="form-group">
        <label>收益率 (%)</label>
        <input type="number" id="yield" value="128.56" step="0.01">
        <div class="hint">正数为盈利（绿色），负数为亏损（红色）</div>
      </div>

      <!-- 自动计算价格开关 -->
      <div class="form-group switch-group">
        <label>🔄 自动计算价格</label>
        <label class="switch">
          <input type="checkbox" id="autoCalcPrice" onchange="toggleAutoCalc()">
          <span class="slider"></span>
        </label>
      </div>

      <!-- 手动输入价格 -->
      <div id="manualPriceSection">
        <div class="form-row">
          <div class="form-group">
            <label>开仓价格</label>
            <input type="number" id="entPrice" value="3245.67" step="0.01">
          </div>
          <div class="form-group">
            <label>当前价格</label>
            <input type="number" id="lastPrice" value="3890.12" step="0.01">
          </div>
        </div>
      </div>

      <!-- 自动计算价格（时间输入） -->
      <div id="autoCalcSection" style="display:none;">
        <div class="form-group">
          <label>开仓时间</label>
          <input type="datetime-local" id="entTime" step="1">
        </div>
        <div class="form-group">
          <label>平仓时间</label>
          <input type="datetime-local" id="closeTime" step="1">
        </div>
        <button class="btn-calc" onclick="fetchPrices()">
          <span>📡</span> 获取历史价格
        </button>
        <div class="hint" id="priceHint" style="margin-top:8px;"></div>
      </div>

      <!-- 显示时间 -->
      <div class="form-group">
        <label>显示时间</label>
        <div style="display:flex;gap:8px;align-items:center;">
          <input type="datetime-local" id="displayTime" step="1" style="flex:1;" disabled>
          <button class="btn-small" id="editTimeBtn" onclick="toggleManualTime()">✏️ 编辑</button>
        </div>
        <div class="hint" id="timeHint">自动同步平仓时间 + 时区转换</div>
      </div>

      <!-- 时区设置 -->
      <div class="form-group">
        <label>🌐 显示时区</label>
        <select id="timezone">
          <option value="-12">UTC-12</option>
          <option value="-11">UTC-11</option>
          <option value="-10">UTC-10</option>
          <option value="-9">UTC-9</option>
          <option value="-8">UTC-8</option>
          <option value="-7">UTC-7</option>
          <option value="-6">UTC-6</option>
          <option value="-5">UTC-5</option>
          <option value="-4">UTC-4</option>
          <option value="-3">UTC-3</option>
          <option value="-2">UTC-2</option>
          <option value="-1">UTC-1</option>
          <option value="0">UTC+0</option>
          <option value="1">UTC+1</option>
          <option value="2">UTC+2</option>
          <option value="3">UTC+3</option>
          <option value="4">UTC+4</option>
          <option value="5">UTC+5</option>
          <option value="6">UTC+6</option>
          <option value="7">UTC+7</option>
          <option value="8" selected>UTC+8</option>
          <option value="9">UTC+9</option>
          <option value="10">UTC+10</option>
          <option value="11">UTC+11</option>
          <option value="12">UTC+12</option>
        </select>
        <div class="hint">图片上显示的时间将转换为此时区</div>
      </div>

      <!-- 邀请码 -->
      <div class="form-group">
        <label>邀请码</label>
        <input type="text" id="refcode" value="5NCXS" placeholder="输入邀请码">
      </div>

      <!-- 按钮 -->
      <button class="btn-generate" id="generateBtn" onclick="generateImage()">
        <span>⚡</span> 生成晒单图
      </button>

      <button class="btn-download" id="downloadBtn" style="display:none;" onclick="downloadImage()">
        <span>⬇️</span> 下载图片
      </button>

      <!-- 快捷操作 -->
      <div class="quick-actions">
        <div class="quick-title">⚡ 快捷操作</div>
        <div class="quick-btns">
          <button onclick="fillRandom()">随机数据</button>
          <button onclick="fillProfit()">盈利示例</button>
          <button onclick="fillLoss()">亏损示例</button>
          <button onclick="clearCache()" style="color:#FF6B6B;">清除缓存</button>
        </div>
      </div>
    </div>

    <!-- 右侧预览区 -->
    <div class="preview-panel">
      <div class="preview-header">
        <div class="preview-header-left">
          <span>📱 实时预览</span>
          <label class="edit-mode-toggle">
            <input type="checkbox" id="editMode" onchange="toggleEditMode()">
            <span class="edit-toggle-slider"></span>
            <span class="edit-toggle-label">编辑模式</span>
          </label>
        </div>
        <!-- 编辑工具栏 - 内嵌在头部 -->
        <div class="edit-toolbar-inline" id="editToolbar" style="display:none;">
          <span id="selectedLayerName">未选中</span>
          <span class="layer-coords" id="layerCoords"></span>
          <label>X:<input type="number" id="layerX" onchange="updateLayerPosition()"></label>
          <label>Y:<input type="number" id="layerY" onchange="updateLayerPosition()"></label>
          <label id="fontSizeLabel" style="display:none;">字号:<input type="number" id="layerFontSize" min="8" max="200" onchange="updateLayerStyle()"></label>
          <label id="fontWeightLabel" style="display:none;">字重:<select id="layerFontWeight" onchange="updateLayerStyle()">
            <option value="100">100 Thin</option>
            <option value="300">300 Light</option>
            <option value="400">400 Regular</option>
            <option value="500">500 Medium</option>
            <option value="600">600 Semi</option>
            <option value="700">700 Bold</option>
            <option value="900">900 Black</option>
          </select></label>
          <label id="letterSpacingLabel" style="display:none;">间距:<input type="number" id="layerLetterSpacing" step="0.1" onchange="updateLayerStyle()"></label>
          <label id="textContentLabel" style="display:none;">内容:<input type="text" id="layerTextContent" onchange="updateLayerStyle()"></label>
          <label id="qrSizeLabel" style="display:none;">尺寸:<input type="number" id="layerQrSize" min="50" max="300" onchange="updateLayerStyle()"></label>
          <button class="btn-tool" onclick="resetLayerPositions()" title="重置">↺</button>
          <button class="btn-tool btn-save" onclick="saveLayerPositions()" title="保存">💾</button>
          <button class="btn-tool btn-export" onclick="exportConfig()" title="导出配置">📤</button>
        </div>
        <div class="preview-controls">
          <div class="zoom-controls">
            <button onclick="zoomCanvas(-0.1)" title="缩小">−</button>
            <span id="zoomValue">50%</span>
            <button onclick="zoomCanvas(0.1)" title="放大">+</button>
            <button onclick="resetZoom()" title="重置">⟲</button>
          </div>
          <span id="previewSize">1050 × 1696</span>
        </div>
      </div>
      <div class="preview-container" id="previewContainer">
        <div class="canvas-wrapper" id="canvasWrapper">
          <img class="canvas-bg" id="canvasBg" src="" alt="背景">
          <div class="layer-overlay" id="layerOverlay"></div>
        </div>
      </div>
      <div id="renderContainer" style="position: absolute; left: -9999px; top: 0;"></div>
    </div>
  </div>

  <script src="js/html2canvas.min.js"></script>
  <script src="js/qrcode.min.js"></script>
  <script src="js/backgrounds.js"></script>
  <script src="js/config.js?v=1.1"></script>
  <script src="js/app.js?v=1.1"></script>
</body>
</html>
